<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>LuxeCars | Luxury Car Renting</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/style.css">
    <link rel="icon" type='image/jpeg' href="/Favicon Luxecars.jpeg" />
</head>

<body class="luxecars">

    <header class="header-info" style="background-image: url('/imagen principal del info.jpeg');">
        <div class="main-title-info">
            <h2>{{brand.brandName}}</h2>
        </div>
    </header>

    <!-- Navbar implemented with Mustache Partials -->
    {{> nav_bar }}

    <!-- Brand deletion confirmation pop-up -->
    {{> dialog_popup}}


    <!-- Brand's info -->
    <div class="brands" id="brandField" data-brandid="{{brand._id}}">
        <div class="container text-center">
            <div class="mb-0" style="max-width: 800px; margin: 0 auto;">
                <div class="d-flex align-items-center justify-content-center gap-3 mb-3">
                    <a href="/brand/{{_id}}">
                        <img src="/brand/{{brand._id}}/image" alt="{{brand.brandName}}"
                            style="width:auto; height:70px;">
                    </a>
                    <h2 class="m-0">{{brand.brandName}}</h2>
                    <span>|</span>
                    <h3 class="m-0">{{brand.country}}</h3>
                </div>
                <p style="font-size: 1rem; color: #444;">{{brand.description}}</p>
                <div class="button-group mb-4">
                    <a href="/brand/{{brand._id}}/edit" class="btn btn-sm btn-outline-primary">Edit</a>
                    <a class="btn btn-sm btn-outline-danger" id="brandDeletionButton"
                        data-brandid="{{brand._id}}">Delete</a>
                    <a href="/" class="btn btn-sm btn-outline-secondary">Back</a>
                </div>
            </div>
        </div>
    </div>


    <!-- Brand's models -->
    <div class="container mt-4" id="brandModelSection">
        {{#brand.models}}
        <div class="brand-card" id="{{name}}" data-modelname="{{name}}" data-brandid="{{brand._id}}" style="position: relative;">
            <!-- NORMAL VIEW -->
            <div class="mt-3 model-display">
                <img src="/brand/{{brand._id}}/model/{{name}}/image" alt="{{name}}" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%27http://www.w3.org/2000/svg%27 width=%27300%27 height=%27200%27%3E%3Crect fill=%27%23f0f0f0%27 width=%27300%27 height=%27200%27/%3E%3Ctext x=%2750%25%27 y=%2750%25%27 text-anchor=%27middle%27 dy=%27.3em%27 fill=%27%23999%27 font-family=%27Arial%27 font-size=%2716%27%3ENo Image Available%3C/text%3E%3C/svg%3E'">
                <br>
                <span class="car-name">{{name}}</span>
                <span class="car-details">{{year}} ‚Ä¢ {{HP}} HP</span>
                <span class="car-price">{{daily_price}}$/day</span>
                <p class="mt-2" style="font-size:0.9rem; color:#555;">
                    <strong>Technical Specifications:</strong> {{technical_specifications}}
                </p>
                <p style="font-size:0.9rem; color:#555;">
                    <strong>Rental Conditions:</strong> {{rental_conditions}}
                </p>
                <p style="font-size:0.9rem; color:#555;">
                    <strong>Interesting Facts:</strong> {{interesting_facts}}
                </p>
                <div class="button-group mb-4">
                    <a class="btn btn-sm btn-outline-primary editModelButton">Edit</a>
                    <a class="btn btn-sm btn-outline-danger deleteModelButton" data-modelname="{{name}}">Delete</a>
                </div>
            </div>

            <!-- EDIT VIEW (hidden) -->
            <form class="mt-3 model-edit-form d-none" enctype="multipart/form-data">
                <div class="mb-3">
                    <label class="form-label">Name</label>
                    <input type="text" class="form-control model-edit-name" name="modelName" value="{{name}}" required>
                    <span class="model-edit-name-msg"></span>
                </div>

                <div class="mb-3">
                    <label class="form-label">Year of Release</label>
                    <input type="number" class="form-control model-edit-year" name="year" value="{{year}}" required>
                    <span class="model-edit-year-msg"></span>
                </div>

                <div class="mb-3">
                    <label class="form-label">Horsepower</label>
                    <input type="number" class="form-control model-edit-hp" name="HP" value="{{HP}}" required>
                    <span class="model-edit-hp-msg"></span>
                </div>

                <div class="mb-3">
                    <label class="form-label">Daily Price</label>
                    <input type="number" class="form-control model-edit-price" name="daily_price" value="{{daily_price}}" required>
                    <span class="model-edit-price-msg"></span>
                </div>

                <div class="mb-3">
                    <label>Image</label>
                    <div class="drop-zone model-drop-zone">
                        <span>Arrastra una imagen aqu√≠ o haz clic</span>
                        <input type="file" name="image" class="model-image-input" accept="image/*" hidden>
                    </div>
                </div>

                <div class="mb-3">
                    <label>Image Preview</label><br>
                    <small class="model-image-preview"></small>
                    <button type="button" class="btn btn-sm btn-outline-danger ms-2 model-remove-image">Remove Image</button>
                </div>

                <div class="mb-3">
                    <label class="form-label">Technical Specifications</label>
                    <textarea class="form-control model-edit-specs" name="technical_specifications" rows="3" required>{{technical_specifications}}</textarea>
                    <span class="model-edit-specs-msg"></span>
                </div>

                <div class="mb-3">
                    <label class="form-label">Rental conditions</label>
                    <textarea class="form-control model-edit-rental" name="rental_conditions" rows="3" required>{{rental_conditions}}</textarea>
                    <span class="model-edit-rental-msg"></span>
                </div>

                <div class="mb-3">
                    <label class="form-label">Interesting Facts</label>
                    <textarea class="form-control model-edit-facts" name="interesting_facts" rows="3" required>{{interesting_facts}}</textarea>
                    <span class="model-edit-facts-msg"></span>
                </div>

                <div class="button-group d-flex justify-content-between">
                    <button type="submit" class="btn btn-dark model-save-btn">Save Changes</button>
                    <button type="button" class="btn btn-outline-secondary model-cancel-btn">Cancel</button>
                </div>
            </form>
            
            <!-- Spinner for model edit -->
            <div class="d-none spinner-overlay model-edit-spinner">
                <div class="spinner-content">
                    <div class="car-spinner-final">
                        <div class="top-car">üèéÔ∏è</div>
                    </div>
                    <small>Updating model...</small>
                </div>
            </div>
        </div>
        {{/brand.models}}

        {{^brand.models}}
        <p>This brand has no models currently.</p>
        {{/brand.models}}
    </div>

    <!-- FORM SECTION -->
    <section class="brands mt-2" id="createModelForm">
        <h2>Add New Model</h2>
        <div class="container d-flex justify-content-center">
            <form id="createForm" class="car-form p-4 shadow rounded bg-white" style="max-width: 600px; width: 100%;"
                enctype="multipart/form-data">
                <div class="mb-3">
                    <label for="modelName" class="form-label">Name</label>
                    <input type="text" class="form-control" id="model" name="modelName" placeholder="e.g. Ferrari"
                        required>
                    <span id="modelMessage"></span>
                </div>

                <div class="mb-3">
                    <label for="year" class="form-label">Year of Release</label>
                    <input type="number" class="form-control" id="year" name="year" placeholder="e.g. 2010" required>
                    <span id="yearMessage"></span>
                </div>

                <div class="mb-3">
                    <label for="HP" class="form-label">Horsepower</label>
                    <input type="number" class="form-control" id="HP" name="HP" placeholder="e.g. 700" required>
                    <span id="HPMessage"></span>
                </div>

                <div class="mb-3">
                    <label for="daily_price" class="form-label">Daily Price</label>
                    <input type="number" class="form-control" id="daily_price" name="daily_price"
                        placeholder="e.g. 5000" required>
                    <span id="daily_priceMessage"></span>
                </div>

                <div class="mb-3">
                    <label>Image</label>

                    <div id="dropZone" class="drop-zone">
                        <span>Arrastra una imagen aqu√≠ o haz clic</span>
                        <input type="file" name="image" id="imageInputField" accept="image/*" hidden>
                    </div>
                </div>

                <div class="mb-3">
                    <label>Image Preview</label><br>
                    <small id="imgPreviewField"></small>
                    <button type="button" id="removeImageButton" class="btn btn-sm btn-outline-dark ms-2 d-none">
                        Remove
                    </button>
                </div>

                <div class="mb-3">
                    <label for="technical_specifications" class="form-label">Technical Specifications</label>
                    <textarea class="form-control" id="technical_specifications" name="technical_specifications"
                        rows="3" placeholder="Specifications of the car..." required></textarea>
                    <span id="technicalMessage"></span>
                </div>

                <div class="mb-3">
                    <label for="rental_conditions" class="form-label">Rental conditions</label>
                    <textarea class="form-control" id="rental_conditions" name="rental_conditions" rows="3"
                        placeholder="Conditions to rent the car..." required></textarea>
                    <span id="rentalMessage"></span>
                </div>

                <div class="mb-3">
                    <label for="interesting_facts" class="form-label">Interesting Facts</label>
                    <textarea class="form-control" id="interesting_facts" name="interesting_facts" rows="3"
                        placeholder="Some data about the car..." required></textarea>
                    <span id="factsMessage"></span>
                </div>

                <button type="submit" class="btn btn-dark w-100" id="createButton">Create</button>
                <div class="button-group d-flex justify-content-between d-none" id="editButtonGroup">
                    <button class="btn btn-outline-dark confirmEdit">Save Changes</button>
                    <a class="btn btn-outline-secondary cancelEditModel">Cancel</a>
                </div>
            </form>
            <div id="model-spinner" class="d-none spinner-overlay">
                <div class="spinner-content">
                    <div class="car-spinner-final">
                        <div class="top-car">üèéÔ∏è</div>
                    </div>
                    <small>Creating model...</small>
                </div>
            </div>
    </section>

    <!-- Main Edit section-->
    <section class="brands d-none" id="editModelForm">
        <div class="container d-flex justify-content-center">
            <form id="editForm" class="car-form p-4 shadow rounded bg-white" enctype="multipart/form-data"
                style="max-width: 600px; width: 100%;">

                <div class="mb-3">
                    <label for="modelName">Model Name</label>
                    <input type="text" name="modelName" id="modelNameInputField" class="form-control" value="" required>
                </div>

                <div class="mb-3">
                    <label for="HP">Horse Power (HP)</label>
                    <input type="text" name="HP" id="HPInputField" class="form-control" value="" required>
                </div>

                <div class="mb-3">
                    <label for="year">Year</label>
                    <input name="year" class="form-control" id="yearInputField" type="number" value="" required>
                </div>

                <div class="mb-3">
                    <label for="daily_price">Daily price (Dollars per day)</label>
                    <input type="text" name="daily_price" id="dailyPriceInputField" class="form-control" value=""
                        required>
                </div>

                <div class="mb-3">
                    <label>Image</label>

                    <div id="dropZone" class="drop-zone">
                        <span>Arrastra una imagen aqu√≠ o haz clic</span>
                        <input type="file" name="image" id="imageInputField" accept="image/*" hidden>
                    </div>
                </div>

                <div class="mb-3">
                    <label>Image Preview</label><br>
                    <small id="imgPreviewField"></small>
                    <button type="button" id="removeImageButton" class="btn btn-sm btn-outline-dark ms-2 d-none">
                        Remove
                    </button>
                </div>


                <div class="mb-3">
                    <label for="technical_specifications">Technical Specifications</label>
                    <textarea name="technical_specifications" class="form-control" id="techSpecsInputField" rows="4"
                        required></textarea>
                </div>

                <div class="mb-3">
                    <label for="rental_conditions">Rental Conditions</label>
                    <textarea name="rental_conditions" class="form-control" id="rentCondInputField" rows="4"
                        required></textarea>
                </div>

                <div class="mb-3">
                    <label for="interesting_facts">Interesting Facts</label>
                    <textarea name="interesting_facts" class="form-control" id="inteFactsInputField" rows="4"
                        required></textarea>
                </div>

                <div class="button-group d-flex justify-content-between">
                    <button class="btn btn-outline-dark confirmEdit">Save Changes</button>
                    <a class="btn btn-outline-secondary cancelEditModel">Cancel</a>
                </div>
            </form>
    </section>


    <!-- Footer implemented with Mustache Partials -->
    {{> footer }}


</body>
<script src="/client.js"></script>

</html>